(function(n,t){"use strict";Foundation.libs["magellan-expedition"]={name:"magellan-expedition",version:"5.5.2",settings:{active_class:"active",threshold:0,destination_threshold:20,throttle_delay:30,fixed_top:0,offset_by_height:!0,duration:700,easing:"swing"},init:function(n,t,i){Foundation.inherit(this,"throttle");this.bindings(t,i)},events:function(){var t=this,i=t.S,r=t.settings;t.set_expedition_position();i(t.scope).off(".magellan").on("click.fndtn.magellan","["+t.add_namespace("data-magellan-arrival")+"] a[href*=#]",function(i){var h=this.hostname===location.hostname||!this.hostname,c=t.filterPathname(location.pathname)===t.filterPathname(this.pathname),l=this.hash.replace(/(:|\.|\/)/g,"\\$1"),o=this,f;if(h&&c&&l){i.preventDefault();var s=n(this).closest("["+t.attr_name()+"]"),r=s.data("magellan-expedition-init"),u=this.hash.split("#").join(""),e=n('a[name="'+u+'"]');e.length===0&&(e=n("#"+u));f=e.offset().top-r.destination_threshold+1;r.offset_by_height&&(f=f-s.outerHeight());n("html, body").stop().animate({scrollTop:f},r.duration,r.easing,function(){history.pushState?history.pushState(null,null,o.pathname+"#"+u):location.hash=o.pathname+"#"+u})}}).on("scroll.fndtn.magellan",t.throttle(this.check_for_arrivals.bind(this),r.throttle_delay))},check_for_arrivals:function(){var n=this;n.update_arrivals();n.update_expedition_positions()},set_expedition_position:function(){var t=this;n("["+this.attr_name()+"=fixed]",t.scope).each(function(){var i=n(this),f=i.data("magellan-expedition-init"),e=i.attr("styles"),u,r;i.attr("style","");u=i.offset().top+f.threshold;r=parseInt(i.data("magellan-fixed-top"));isNaN(r)||(t.settings.fixed_top=r);i.data(t.data_attr("magellan-top-offset"),u);i.attr("style",e)})},update_expedition_positions:function(){var i=this,r=n(t).scrollTop();n("["+this.attr_name()+"=fixed]",i.scope).each(function(){var t=n(this),f=t.data("magellan-expedition-init"),e=t.attr("style"),o=t.data("magellan-top-offset"),u;r+i.settings.fixed_top>=o?(u=t.prev("["+i.add_namespace("data-magellan-expedition-clone")+"]"),u.length===0&&(u=t.clone(),u.removeAttr(i.attr_name()),u.attr(i.add_namespace("data-magellan-expedition-clone"),""),t.before(u)),t.css({position:"fixed",top:f.fixed_top}).addClass("fixed")):(t.prev("["+i.add_namespace("data-magellan-expedition-clone")+"]").remove(),t.attr("style",e).css("position","").css("top","").removeClass("fixed"))})},update_arrivals:function(){var i=this,r=n(t).scrollTop();n("["+this.attr_name()+"]",i.scope).each(function(){var t=n(this),u=t.data(i.attr_name(!0)+"-init"),e=i.offsets(t,r),o=t.find("["+i.add_namespace("data-magellan-arrival")+"]"),f=!1;e.each(function(n,r){if(r.viewport_offset>=r.top_offset){var e=t.find("["+i.add_namespace("data-magellan-arrival")+"]");return e.not(r.arrival).removeClass(u.active_class),r.arrival.addClass(u.active_class),f=!0,!0}});f||o.removeClass(u.active_class)})},offsets:function(t,i){var r=this,u=t.data(r.attr_name(!0)+"-init"),f=i;return t.find("["+r.add_namespace("data-magellan-arrival")+"]").map(function(){var o=n(this).data(r.data_attr("magellan-arrival")),e=n("["+r.add_namespace("data-magellan-destination")+"="+o+"]"),i;if(e.length>0)return i=e.offset().top-u.destination_threshold,u.offset_by_height&&(i=i-t.outerHeight()),i=Math.floor(i),{destination:e,arrival:n(this),top_offset:i,viewport_offset:f}}).sort(function(n,t){return n.top_offset<t.top_offset?-1:n.top_offset>t.top_offset?1:0})},data_attr:function(n){return this.namespace.length>0?this.namespace+"-"+n:n},off:function(){this.S(this.scope).off(".magellan");this.S(t).off(".magellan")},filterPathname:function(n){return n=n||"",n.replace(/^\//,"").replace(/(?:index|default).[a-zA-Z]{3,4}$/,"").replace(/\/$/,"")},reflow:function(){var t=this;n("["+t.add_namespace("data-magellan-expedition-clone")+"]",t.scope).remove()}}})(jQuery,window,window.document);